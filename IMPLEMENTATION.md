# Hyprland Dotfiles Implementation Guide

## Philosophy
- **Use ML4W's complete, working approach as the foundation**
- **Comment out features we don't need rather than deleting them**
- **Keep all ML4W code intact for future use**
- **Every change must be automated in setup scripts for reproducibility**
- **NO MANUAL COMMANDS - All fixes must be done at the script/file level**
- **Update paths from ml4w to my but preserve all functionality**

## Approach: Comment Out, Don't Delete

Instead of creating new simplified scripts, we:
1. **Copy ML4W scripts intact**
2. **Update paths from ml4w → my**
3. **Comment out features we don't currently want**
4. **Keep commented code for future reference**

This way we maintain the full ML4W functionality and can easily enable features later.

## Directory Structure

Our dotfiles use **"my"** namespace (not ml4w) and GNU Stow for management:

```
~/dotfiles/stow/
├── hypr/.config/hypr/         # Hyprland window manager config
│   ├── conf/                  # Modular config files
│   ├── scripts/               # Hyprland/Wayland specific scripts (ML4W based)
│   ├── settings/              # Hyprland app launcher configs
│   └── colors.conf            # Generated by matugen
├── my/.config/my/             # General OS configuration (ML4W ml4w → my)
│   ├── scripts/               # System scripts (updates, etc.)
│   ├── settings/              # General settings (blur, etc.)
│   ├── listeners/             # File watchers (ML4W based)
│   ├── wallpapers/            # Default wallpapers
│   └── library.sh             # Shared functions (ML4W based)
├── waybar/.config/waybar/     # Status bar (ML4W based, theme switching commented out)
├── waypaper/.config/waypaper/ # Wallpaper manager
├── wofi/.config/wofi/         # Application launcher
└── wlogout/.config/wlogout/   # Logout menu
```

## What We're Commenting Out (Not Deleting)

From ML4W scripts:
- ❌ Waybar theme switching logic (keep code, comment out)
- ❌ Multiple waybar theme loading (comment out theme file reading)
- ❌ GTK theme listener functionality (comment out in listeners.sh)
- ❌ ML4W Welcome app launches (comment out autostart calls)
- ❌ Game mode features (comment out)
- ❌ Update checker calls (comment out)

## GTK Configuration Philosophy

**We use GTK4 only:**
- ✅ Modern GTK4 applications will be properly styled
- ✅ Simpler configuration (one GTK version to manage)
- ✅ Future-proof approach
- ⚠ Older GTK3 applications will use system defaults (acceptable trade-off)
- **Only copy `~/.config/gtk-4.0/` from ML4W, ignore `~/.config/gtk-3.0/`**
- **Remove existing `~/.config/gtk-3.0/` if present**

## Implementation Plan

### Phase 1: Update Paths Only
We need to update paths from ml4w to my in these files:

#### Files that need path updates:
1. `wallpaper-restore.sh` - Update cache paths
2. `wallpaper.sh` - Update cache and settings paths  
3. `library.sh` - Update log paths
4. `listeners.sh` - Update paths to settings
5. Any other scripts referencing `~/.config/ml4w/` or `~/.cache/ml4w/`

#### Path mapping:
| ML4W Path | Our Path |
|-----------|----------|
| `~/.config/ml4w/` | `~/.config/my/` |
| `~/.cache/ml4w/hyprland-dotfiles/` | `~/.cache/my/` |
| `$ml4w_cache_folder` | `$my_cache_folder` |

### Phase 2: Test Waybar Interactive Elements

**Goal**: Test every clickable element in waybar to ensure all scripts work without errors.

**Approach**: Test one script at a time, fix path issues as discovered.

#### Waybar Elements to Test:
1. **Application Launcher** (`custom/appmenu`): `wofi --show=drun`
2. **Wallpaper Selection** (`custom/wallpaper`): `waypaper` and `wallpaper-effect.sh`
3. **Settings** (`custom/settings`): `gnome-control-center`
4. **Keybindings** (`custom/keybindings`): `keybindings.sh`
5. **File Manager** (`custom/filemanager`): `filemanager.sh`
6. **Browser** (`custom/browser`): `browser.sh`
7. **AI Assistant** (`custom/ai`): `chromium --app=https://claude.ai/chat`
8. **Calculator** (`custom/calculator`): `qalculate-gtk`
9. **Power Menu** (`custom/exit`): `wlogout.sh`
10. **Notifications** (`custom/notification`): `swaync-client`
11. **Hyprshade** (`custom/hyprshade`): `hyprshade.sh`
12. **Hypridle** (`custom/hypridle`): `hypridle.sh`
13. **Clipboard** (`custom/cliphist`): `cliphist.sh`
14. **Network** (`network`): `networkmanager.sh` and `nm-applet.sh`
15. **System Monitor** (`cpu`/`memory`/`disk`): `system-monitor.sh`

#### Testing Method:
```bash
# For each waybar element:
# 1. Test the script/command from terminal
# 2. Fix ALL errors and warnings until output is clean
# 3. Ask user to confirm it looks correct on screen
# 4. Only move to next element when both conditions are met:
#    - No errors/warnings in terminal output
#    - User confirms visual appearance is correct
```

#### Testing Requirements:
**CRITICAL**: Every script must launch without ANY errors or warnings before moving forward.
**CRITICAL**: User must confirm visual appearance is correct on screen.
**NO EXCEPTIONS**: Both conditions must be met before proceeding to next element.

#### Expected Fixes:
- Update paths from `~/.config/ml4w/` to `~/.config/my/`
- Fix missing script files
- Update script permissions
- Fix script dependencies
- Fix CSS/theme import errors
- Fix missing configuration files

### Phase 3: Comment Out Unneeded Features

#### In waybar/launch.sh:
- Keep theme loading logic but comment it out
- Keep one simple theme as default
- Keep ML4W's locking mechanism

#### In wallpaper.sh:
- Keep theme switching calls but comment them out
- Keep matugen color generation active
- Keep waybar reload active

#### In listeners.sh:
- Keep GTK theme listener but comment out the --startall call
- Keep code intact for future use

#### In autostart.conf:
- Keep ML4W app launches but comment them out
- Keep essential services active

### Phase 4: Test Individual Keybindings

Since we're keeping ML4W's approach intact, we can test:

1. **Test wallpaper system**:
   ```bash
   ~/.config/hypr/scripts/wallpaper-restore.sh
   # Should work with our paths
   ```

2. **Test waybar launch**:
   ```bash
   ~/.config/waybar/launch.sh  
   # Should work with simplified theme
   ```

3. **Test matugen color generation**:
   ```bash
   ~/.config/hypr/scripts/wallpaper.sh ~/path/to/image.jpg
   # Should generate colors and reload waybar
   ```

## Files That Need Manual Path Updates

### 1. wallpaper-restore.sh
```bash
# Change:
my_cache_dir="$HOME/.cache/my/hyprland-dotfiles"
# To:
my_cache_dir="$HOME/.cache/my"

# Change:
defaultwallpaper="$HOME/.config/ml4w/wallpapers/default.jpg"
# To:  
defaultwallpaper="$HOME/.config/my/wallpapers/default.jpg"
```

### 2. wallpaper.sh  
```bash
# Change:
my_cache_folder="$HOME/.cache/ml4w/hyprland-dotfiles"
# To:
my_cache_folder="$HOME/.cache/my"

# Change references to:
~/.config/ml4w/settings/blur.sh → ~/.config/my/settings/blur.sh
~/.config/ml4w/wallpapers/ → ~/.config/my/wallpapers/
```

### 3. library.sh
```bash
# Update log directory to use our cache
```

### 4. listeners.sh
```bash
# Update paths to ~/.config/my/settings/
```

## Implementation Steps

### Step 1: Apply Setup Scripts We Already Have
```bash
cd ~/dotfiles
# Run directory creation
./scripts/setup_directories.sh

# Apply symlinks - stow automatically handles folding
cd ~/dotfiles/stow
stow --no-folding -vv -d "$HOME/dotfiles/stow" -t "$HOME" *
# Stow automatically decides:
# - Fold where clean (e.g., ~/.config/matugen -> ../../dotfiles/stow/matugen/.config/matugen)
# - Individual file symlinks where conflicts exist (e.g., hypr, wofi)
# - Example: ~/.config/hypr/hyprland.conf -> ../../dotfiles/stow/hypr/.config/hypr/hyprland.conf
```

### Step 2: Manual Path Updates
Edit each file individually to update paths:
```bash
# Edit wallpaper-restore.sh
vim ~/dotfiles/stow/hypr/.config/hypr/scripts/wallpaper-restore.sh
# Update cache paths manually

# Edit wallpaper.sh
vim ~/dotfiles/stow/hypr/.config/hypr/scripts/wallpaper.sh  
# Update all ml4w paths to my

# Repeat for other scripts...
```

### Step 3: Comment Out Unneeded Features
```bash
# In waybar launch.sh - you've already done this
# In autostart.conf - comment out ML4W app launches
# In listeners.sh - comment out theme switching
```

### Step 4: Create Missing Config Files
```bash
# Ensure these exist:
echo "50x30" > ~/dotfiles/stow/my/.config/my/settings/blur.sh
echo "off" > ~/dotfiles/stow/hypr/.config/hypr/settings/wallpaper-effect.sh

# Add a default wallpaper image to:
# ~/dotfiles/stow/my/.config/my/wallpapers/default.jpg
```

### Step 5: Configure Waypaper
Create `~/dotfiles/stow/waypaper/.config/waypaper/config.toml`:
```toml
[Settings]
language = "en"
wallpaper = "~/.config/my/wallpapers/default.jpg"
backend = "hyprpaper"
post_command = "~/.config/hypr/scripts/wallpaper.sh"
```

### Step 6: Test Components
```bash
# Run our test script
~/dotfiles/scripts/test_hyprland_setup.sh

# Test individual components
~/.config/hypr/scripts/wallpaper-restore.sh
~/.config/waybar/launch.sh
```

## Benefits of This Approach

1. **Complete ML4W functionality preserved** - can be re-enabled later
2. **Proven, working codebase** - ML4W is battle-tested
3. **Easy to extend** - uncomment features as needed  
4. **Maintainable** - clear what was changed vs original
5. **Educational** - can see how ML4W implements features

## Testing Strategy

Since we're using ML4W's approach, we test the same way:
1. Wallpaper restoration triggers the chain
2. Wallpaper.sh generates colors and launches waybar
3. All components start in the right order
4. Theming works through matugen

The only difference is our simplified paths and commented-out features.

## Current Status Check

Before proceeding, verify:
- [ ] Cache directories exist: `~/.cache/my/`
- [ ] Symlinks applied: `~/.config/hypr`, `~/.config/waybar`, etc.
- [ ] Scripts executable: `chmod +x *.sh`
- [ ] Waypaper installed and configured
- [ ] Default wallpaper exists
- [ ] Paths updated in scripts

Then test individual components before enabling full autostart.

## Future UI Improvements

### Settings Menu Integration

Following the ML4W approach, add a settings/toggles menu accessible from waybar that includes:

#### Component Toggles Dropdown:
- **Dock Toggle**: Enable/disable nwg-dock-hyprland
  - File: `~/.config/hypr/settings/dock-disabled`
  - Command: `touch ~/.config/hypr/settings/dock-disabled` (disable)
  - Command: `rm ~/.config/hypr/settings/dock-disabled` (enable)
- **Additional toggles** can be added following the same pattern:
  - Waybar modules (network, system monitor, etc.)
  - Desktop effects (blur, animations)
  - Notification system
  - Auto-update features

#### Implementation Pattern:
```bash
# For any component toggle:
# 1. Create disable file in ~/.config/hypr/settings/[component]-disabled
# 2. Check for file in component's launch script:
if [ ! -f "$HOME/.config/hypr/settings/[component]-disabled ]; then
    # Launch component
else
    killall [component] 2>/dev/null
    echo ":: [Component] disabled"
fi
```

This creates a consistent, user-friendly way to toggle components on/off similar to ML4W's settings system.